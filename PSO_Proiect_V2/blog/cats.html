<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <title>Pisici Adorabile</title>
    <link rel="stylesheet" href="/cats.css">
</head>
<body>
    <h1>Pisici Adorabile</h1>
    <p>Lasă un comentariu despre pisici!</p>

    <div class="cat-container">
        <img src="img/cat1.jpg" alt="Pisica 1" class="cat">
        <img src="img/cat2.jpg" alt="Pisica 2" class="cat">
        <img src="img/cat3.jpg" alt="Pisica 3" class="cat">
    </div>

    <div class="form-container">
        <!-- action/method nu mai conteaza, trimitem cu fetch -->
        <form id="commentForm">
            <input type="text" name="username" placeholder="Numele tău" required>
            <textarea name="message" placeholder="Comentariul tău..." rows="4" required></textarea>
            <button type="submit">Trimite Comentariu</button>
        </form>
    </div>

    <div class="comments">
        <h3>Comentarii:</h3>
        <div id="comments-list"></div>
    </div>

    <br>
    <a href="/" class="back-btn">Înapoi la pagina principală</a>

    <script>
        async function loadComments() {
            const res = await fetch('/api/comments');
            const comments = await res.json();
            const list = document.getElementById('comments-list');
            if (comments.length === 0) {
                list.innerHTML = '<p style="color:#999; font-style:italic;">Încă nu sunt comentarii. Fii primul!</p>';
                return;
            }
            list.innerHTML = comments.map(c =>
                `<div class="comment"><strong>${c.username}</strong>: ${c.message}</div>`
            ).join('');
        }

        document.getElementById('commentForm').addEventListener('submit', async (e) => {
            e.preventDefault(); // NU mai lasam browserul sa faca submit normal

            const form = e.target;
            const formData = new FormData(form);
            const body = new URLSearchParams(formData);  // => application/x-www-form-urlencoded

            const res = await fetch('/submit-comment', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded'
                },
                body: body.toString()
            });

            if (!res.ok) {
                console.error('Eroare la trimitere comentariu', await res.text());
                return;
            }

            form.reset();   // golim formularul
            loadComments(); // reîncarcam lista de comentarii
        });

        window.addEventListener('load', loadComments);
    </script>
</body>
</html>
